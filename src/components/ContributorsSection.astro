---
// Contributors Section - Fetching real data from GitHub API

interface Contributor {
  id: number;
  login: string;
  avatar_url: string;
  html_url: string;
  contributions: number;
}

// Fetch real contributors from GitHub API
let contributors: Contributor[] = [];
try {
  const response = await fetch('https://api.github.com/repos/ferriskey/ferriskey/contributors');
  if (response.ok) {
    contributors = await response.json();
  }
} catch (error) {
  console.error('Failed to fetch contributors:', error);
}

const repoOwner = 'ferriskey';
const repoName = 'ferriskey';

const totalContributions = contributors.reduce((sum, c) => sum + c.contributions, 0);
const activeContributors = contributors.filter((c) => c.contributions > 10).length;
---

<section id="contributors" class="section-py relative">
  <div class="container-custom">
    <!-- Section Header -->
    <div class="max-w-3xl mx-auto text-center mb-16">
      <h2 class="mb-6">
        <span class="text-white">Our </span>
        <span class="text-gradient">Contributors</span>
      </h2>
      <p class="text-xl text-slate-400 leading-relaxed">
          FerrisKey is made possible by a global community of passionate contributors.
         Thank you to everyone who is helping to advance the project! üôè
      </p>
    </div>

    <!-- Contributors Grid -->
    <div class="max-w-7xl mx-auto">
      <div class="flex flex-wrap justify-center gap-4" id="contributors-grid">
        {contributors.map((contributor, index) => (
          <a
            href={contributor.html_url}
            target="_blank"
            rel="noopener noreferrer"
            class="contributor-item group relative flex items-center justify-center"
            style={`animation-delay: ${index * 0.02}s;`}
          >
            <div class="w-16 h-16 rounded-full overflow-hidden border-2 border-slate-700 group-hover:border-ferris-500 transition-all duration-300 group-hover:scale-110 shadow-lg">
              <img
                src={contributor.avatar_url}
                alt={contributor.login}
                class="w-full h-full object-cover"
                loading="lazy"
              />
            </div>

            <!-- Tooltip -->
            <div class="contributor-tooltip absolute -top-16 left-1/2 transform -translate-x-1/2 px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none whitespace-nowrap z-10 shadow-xl">
              <p class="text-sm font-medium text-white">{contributor.login}</p>
              <p class="text-xs text-slate-400 mt-0.5">
                {contributor.contributions} contribution{contributor.contributions > 1 ? 's' : ''}
              </p>
              <!-- Arrow -->
              <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-slate-900 border-b border-r border-slate-700 rotate-45" />
            </div>

            <!-- Contribution badge for top contributors -->
            {contributor.contributions > 20 && (
              <div class="absolute -bottom-0.5 right-0.5 w-5 h-5 bg-ferris-500 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-lg border-2 border-slate-950">
                ‚≠ê
              </div>
            )}

            <!-- Glow effect on hover -->
            <div class="absolute inset-0 rounded-full bg-ferris-500/0 group-hover:bg-ferris-500/20 transition-colors duration-300 blur-sm" />
          </a>
        ))}
      </div>

      <!-- Stats -->
      <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
        <div class="card p-6 text-center">
          <div class="text-4xl font-bold text-gradient mb-2">
            {contributors.length}
          </div>
          <p class="text-sm text-slate-400">Contributors</p>
        </div>
        <div class="card p-6 text-center">
          <div class="text-4xl font-bold text-gradient mb-2">
            {totalContributions.toLocaleString()}
          </div>
          <p class="text-sm text-slate-400">Total contributions</p>
        </div>
        <div class="card p-6 text-center">
          <div class="text-4xl font-bold text-gradient mb-2">
            {activeContributors}
          </div>
          <p class="text-sm text-slate-400">Active contributors</p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .contributor-item {
    animation: fadeIn 0.6s ease-out backwards;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.8);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>
