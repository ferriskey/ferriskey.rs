---
// Open Source Community section - contributors with colored avatars
interface Contributor {
  id: number;
  login: string;
  avatar_url: string;
  html_url: string;
  contributions: number;
}

let contributors: Contributor[] = [];
try {
  const response = await fetch('https://api.github.com/repos/ferriskey/ferriskey/contributors');
  if (response.ok) {
    contributors = await response.json();
  }
} catch (error) {
  console.error('Failed to fetch contributors:', error);
}

// Accent colors for avatar borders (cycling)
const borderColors = [
  'border-ferris-500',
  'border-ocean-500',
  'border-purple-500',
  'border-green-500',
  'border-amber-500',
  'border-pink-500',
  'border-teal-500',
  'border-red-500',
];
---

<section id="community" class="py-24 relative">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Section Header -->
    <div class="mb-10 reveal">
      <p class="text-xs text-ferris-400 font-mono uppercase tracking-widest mb-3">Open Source Community</p>
      <h2 class="text-4xl sm:text-5xl font-bold text-white mb-4">
        Open Source Community
      </h2>
      <p class="text-lg text-slate-400 max-w-2xl">
        Code · Design · Triage · GitHub Stars · product feedback
      </p>
    </div>

    <!-- Contributors Avatars -->
    {contributors.length > 0 ? (
      <div class="flex flex-wrap gap-2 mb-10 reveal reveal-delay-1">
        {contributors.map((contributor, index) => (
          <a
            href={contributor.html_url}
            target="_blank"
            rel="noopener noreferrer"
            class="group relative"
            title={`${contributor.login} — ${contributor.contributions} contributions`}
          >
            <div class={`w-10 h-10 rounded-full overflow-hidden border-2 ${borderColors[index % borderColors.length]} group-hover:scale-110 transition-transform duration-200 shadow-lg`}>
              <img
                src={contributor.avatar_url}
                alt={contributor.login}
                class="w-full h-full object-cover"
                loading="lazy"
              />
            </div>
          </a>
        ))}
      </div>
    ) : (
      <!-- Placeholder colored circles if API fails -->
      <div class="flex flex-wrap gap-2 mb-10">
        {borderColors.concat(borderColors).map((color, i) => (
          <div class={`w-10 h-10 rounded-full border-2 ${color} bg-slate-800`}></div>
        ))}
      </div>
    )}

    <!-- Stats -->
    <div class="flex flex-wrap gap-8 text-sm reveal reveal-delay-2">
      <div>
        <span class="text-2xl font-bold text-white">{contributors.length || '20+'}</span>
        <span class="text-slate-500 ml-2">Contributors</span>
      </div>
      <div>
        <span class="text-2xl font-bold text-white">100%</span>
        <span class="text-slate-500 ml-2">Open Source</span>
      </div>
      <div>
        <span class="text-2xl font-bold text-white">Apache 2.0</span>
        <span class="text-slate-500 ml-2">License</span>
      </div>
    </div>

  </div>
</section>
